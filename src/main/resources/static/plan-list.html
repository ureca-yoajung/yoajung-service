<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš”ê¸ˆì œ ë¦¬ìŠ¤íŠ¸ - YOAJUNG</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/884094d6e6.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="assets/css/plan-list.css"/>
</head>

<body>
    <!-- Navigation -->
    <div id="navbar"></div>

    <div class="main-content">
        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-container">
                <h1 class="filter-title">ìš”ê¸ˆì œ</h1>
                <div class="category-menu">
                    <button type="button" class="category-btn active" onclick="filterByCategory('all')">ì „ì²´</button>
                    <button type="button" class="category-btn" onclick="filterByCategory('LTE_FIVE_G')">5G/LTE</button>
                    <button type="button" class="category-btn" onclick="filterByCategory('ONLINE_ONLY')">ì˜¨ë¼ì¸ ì „ìš©</button>
                </div>
            </div>
        </div>

        <!-- Plans Container -->
        <div class="plans-container">
            <div class="plans-header">
                <div class="plans-count" id="plansCount">ì´ 0ê°œì˜ ìš”ê¸ˆì œ</div>
                <div class="plans-filter">
                    <select class="sort-select" id="mainSortSelect">
                        <option value="POPULAR">ì¸ê¸°ìˆœ</option>
                        <option value="LOW_PRICE">ê°€ê²© ë‚®ì€ìˆœ</option>
                        <option value="HIGH_PRICE">ê°€ê²© ë†’ì€ìˆœ</option>
                        <option value="DATA">ë°ì´í„° ë§ì€ìˆœ</option>
                    </select>
                    <select class="sort-select" id="mainAgeSelect" style="display: block;">
                        <option value="ALL">ì „ì²´</option>
                        <option value="TWENTY_S">20ëŒ€</option>
                        <option value="THIRTY_S">30ëŒ€</option>
                        <option value="FORTY_S">40ëŒ€</option>
                        <option value="FIFTY_S">50ëŒ€</option>
                        <option value="SIXTY_S_PLUS">60ëŒ€ ì´ìƒ</option>
                    </select>
                    <div class="plan-user-filter" id="openFilterModalBtn" style="cursor:pointer;">
                        <i class="fa-solid fa-filter"></i>
                        <p>í•„í„°</p>
                    </div>
                </div>
    <!-- Filter Modal -->
    <div id="planFilterModal" class="plan-filter-modal" style="display:none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>ìš”ê¸ˆì œ ìƒì„¸ í•„í„°</h2>
                <button class="modal-close-btn" id="closeFilterModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="planFilterForm">
                    <div class="filter-row">
                        <label for="modalSortSelect">ì •ë ¬:</label>
                        <select id="modalSortSelect" name="sort">
                            <option value="POPULAR">ì¸ê¸°ìˆœ</option>
                            <option value="LOW_PRICE">ë‚®ì€ê°€ê²©ìˆœ</option>
                            <option value="HIGH_PRICE">ë†’ì€ê°€ê²©ìˆœ</option>
                            <option value="DATA">ë°ì´í„° ë§ì€ ìˆœ</option>
                        </select>
                    </div>
                    <div class="filter-row" id="modalAgeFieldset">
                        <fieldset>
                            <legend>ì—°ë ¹ëŒ€</legend>
                            <label><input type="radio" name="ageGroup" value="ALL" checked>ì „ì²´</label>
                            <label><input type="radio" name="ageGroup" value="TWENTY_S">20ëŒ€</label>
                            <label><input type="radio" name="ageGroup" value="THIRTY_S">30ëŒ€</label>
                            <label><input type="radio" name="ageGroup" value="FORTY_S">40ëŒ€</label>
                            <label><input type="radio" name="ageGroup" value="FIFTY_S">50ëŒ€</label>
                            <label><input type="radio" name="ageGroup" value="SIXTY_S_PLUS">60ëŒ€+</label>
                        </fieldset>
                    </div>
                    <div class="filter-row">
                        <label for="modalCategorySelect">ì¹´í…Œê³ ë¦¬:</label>
                        <select id="modalCategorySelect" name="category">
                            <option value="ALL">ì „ì²´</option>
                            <option value="LTE_FIVE_G">5G/LTE</option>
                            <option value="ONLINE_ONLY">ì˜¨ë¼ì¸ ì „ìš©</option>
                        </select>
                    </div>
                    <div class="filter-row">
                        <fieldset>
                            <legend>ë°ì´í„°</legend>
                            <label><input type="radio" name="dataType" value="UNLIMITED">ë¬´ì œí•œ</label>
                            <label><input type="radio" name="dataType" value="FIXED">ì •ëŸ‰</label>
                            <label><input type="radio" name="dataType" value="THROTTLED">ì†ë„ì œí•œ</label>
                            <label><input type="radio" name="dataType" value="" checked>ìƒê´€ì—†ìŒ</label>
                        </fieldset>
                    </div>
                    <div class="filter-row">
                        <fieldset>
                            <legend>ìš”ê¸ˆ ë²”ìœ„</legend>
                            <label><input type="radio" name="priceRange" value="UNDER5">~5ë§Œì›</label>
                            <label><input type="radio" name="priceRange" value="BETWEEN6_8">6~8ë§Œì›</label>
                            <label><input type="radio" name="priceRange" value="ABOVE9">9ë§Œì›~</label>
                            <label><input type="radio" name="priceRange" value="" checked>ìƒê´€ì—†ìŒ</label>
                        </fieldset>
                    </div>
                    <div class="filter-row">
                        <fieldset>
                            <legend>í”„ë¡œë•íŠ¸</legend>
                            <label><input type="checkbox" id="modalNoProduct">í˜œíƒì€ í•„ìš”ì—†ì–´ìš”</label><br>
                            <label><input type="checkbox" name="product" value="ì•„ì´ë“¤ë‚˜ë¼">ì•„ì´ë“¤ë‚˜ë¼</label>
                            <label><input type="checkbox" name="product" value="ë„·í”Œë¦­ìŠ¤">NETFLIX</label>
                            <label><input type="checkbox" name="product" value="ë°”ì´ë¸Œ">ë°”ì´ë¸Œ</label>
                        </fieldset>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="applyFilterBtn" type="button">ê²€ìƒ‰</button>
            </div>
        </div>
    </div>
            </div>

            <div class="detailed-plans-grid" id="plans-grid">
                <!-- Plans will be populated by API -->
            </div>

            <!-- Load More Button -->
            <div class="load-more-container" id="loadMoreContainer" style="display: none;">
                <button class="load-more-btn" id="loadMoreBtn" type="button">
                    <span class="current-count" id="currentCount">0</span>ê°œ / ì´ <span id="totalCount">0</span>ê°œ ìƒí’ˆ
                </button>
            </div>
        </div>
    </div>

    <button class="chat-button" onclick="startRecommendation()" title="AI ì¶”ì²œ ë°›ê¸°">ğŸ’¬</button>

    <button id="scrollTopBtn" title="ë§¨ ìœ„ë¡œ"><i class="fa-solid fa-caret-up" style="color: white"></i></button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/assets/navbar.html')
                .then(res => res.text())
                .then(html => {
                    document.getElementById('navbar').innerHTML = html;
                })
                .catch(err => console.error('navbar ë¡œë”© ì‹¤íŒ¨:', err));
        });

        // State management
        let currentPage = 0;
        let pageSize = 9;
        let totalPlans = 0;
        let loadedPlans = [];
        let hasMoreData = true;

        // --- Filter State
        let filterState = {
            category: 'ALL',
            dataType: '',
            priceRange: '',
            productNames: '',
            ageGroup: 'ALL',
            sort: 'POPULAR'
        };

        function resetState() {
            currentPage = 0;
            loadedPlans = [];
            hasMoreData = true;
            totalPlans = 0;
        }

        // Unified API call function for /api/plans (filtering)
        async function fetchPlans(page = 0, size = 9, filter = {}) {
            try {
                const params = new URLSearchParams();
                params.append('page', page);
                params.append('size', size);
                if (filter.category && filter.category !== 'ALL') params.append('category', filter.category);
                if (filter.dataType) params.append('dataType', filter.dataType);
                if (filter.priceRange) params.append('priceRange', filter.priceRange);
                if (filter.productNames) params.append('productNames', filter.productNames);
                if (filter.ageGroup && filter.sort === 'POPULAR' && filter.ageGroup !== 'ALL') params.append('ageGroup', filter.ageGroup);
                if (filter.sort) params.append('sort', filter.sort);

                const response = await fetch(`/api/plans?${params}`);
                const data = await response.json();
                if (data.code === 'READ_PLAN_LIST_200') {
                    // New backend response: { plans: [...], totalCount: N }
                    const plans = (data.data && data.data.plans) ? data.data.plans : [];
                    const totalCount = (data.data && typeof data.data.totalCount === 'number') ? data.data.totalCount : 0;
                    // Normalize backend PlanFilterResponse[] to frontend plan format
                    return {
                        plans: plans.map(item => ({
                            planId: item.id,
                            name: item.name,
                            basePrice: item.basePrice,
                            dataAllowance: item.dataAllowance,
                            speedAfterLimit: item.speedAfterLimit,
                            planCategory: item.planCategory || 'ê¸°íƒ€', // fallback if missing
                            networkType: item.networkType || 'ê¸°íƒ€', // fallback if missing
                            tetheringSharingAllowance: item.tetheringSharingAllowance !== undefined ? item.tetheringSharingAllowance : 0,
                            products: (item.productNames || []).map(name => ({ name })),
                            description: (item.benefits || []).map(b => b.name).join(', ')
                        })),
                        totalCount: totalCount
                    };
                } else {
                    throw new Error(data.message || 'ìš”ê¸ˆì œ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                showError('ìš”ê¸ˆì œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return { plans: [], totalCount: 0 };
            }
        }

        // Render plans function (append mode for load more, replace mode for new filter/sort)
        function renderPlans(plans, append = false) {
            const plansGrid = document.getElementById('plans-grid');

            if (!append) {
                plansGrid.innerHTML = '';
            }

            if (plans.length === 0 && !append) {
                plansGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <h3>í•´ë‹¹í•˜ëŠ” ìš”ê¸ˆì œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }

            plans.forEach(plan => {
                const planCard = document.createElement('div');
                planCard.className = 'detailed-plan-card';
                // Defensively handle undefined fields
                const planCategory = plan.planCategory !== undefined ? plan.planCategory : 'ê¸°íƒ€';
                const networkType = plan.networkType !== undefined ? plan.networkType : 'ê¸°íƒ€';
                const tetheringSharingAllowance = plan.tetheringSharingAllowance !== undefined ? plan.tetheringSharingAllowance : 0;
                planCard.innerHTML = `
                    <div class="plan-header">
                        <h3 class="plan-name">${plan.name}</h3>
                        <span class="network-badge ${networkType.toLowerCase()}">${networkType}</span>
                    </div>
                    <div class="plan-price">ì›” ${plan.basePrice.toLocaleString()}ì›</div>
                    <div class="plan-details">
                        <div class="detail-row">
                            <span class="detail-label">ë°ì´í„°</span>
                            <span class="detail-value">${plan.dataAllowance === 9999 ? 'ë¬´ì œí•œ' : plan.dataAllowance + 'GB'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">í…Œë”ë§</span>
                            <span class="detail-value">${tetheringSharingAllowance === 9999 ? 'ë¬´ì œí•œ' : tetheringSharingAllowance + 'GB'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ì†ë„ì œí•œ í›„</span>
                            <span class="detail-value">${plan.speedAfterLimit}Mbps</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ì¹´í…Œê³ ë¦¬</span>
                            <span class="detail-value">${getCategoryName(planCategory)}</span>
                        </div>
                    </div>
                    <div class="services-section">
                        <div class="services-title">í¬í•¨ ì„œë¹„ìŠ¤</div>
                        <div class="services-list">
                            ${(plan.products || []).map(product => `<span class="service-tag">${product.name}</span>`).join('')}
                        </div>
                    </div>
                    <p class="plan-description">${plan.description || ''}</p>
                    <button class="btn btn-primary btn-large" style="width: 100%;" onclick="goToDetail(${plan.planId})">ìì„¸íˆ ë³´ê¸°</button>
                `;
                plansGrid.appendChild(planCard);
            });

            // Update loaded plans array
            if (append) {
                loadedPlans = [...loadedPlans, ...plans];
            } else {
                loadedPlans = [...plans];
            }
        }

        // Helper functions
        function getCategoryName(category) {
            const categoryNames = {
                'LTE_FIVE_G': '5G/LTE',
                'ONLINE_ONLY': 'ì˜¨ë¼ì¸ì „ìš©',
                'TABLET_WATCH': 'íƒœë¸”ë¦¿/ì›Œì¹˜',
                'DUAL_NUMBER': 'ë“€ì–¼ë„˜ë²„'
            };
            return categoryNames[category] || category;
        }

        function showError(message) {
            const plansGrid = document.getElementById('plans-grid');
            plansGrid.innerHTML = `
                <div class="error-state" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                    <h3>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3>
                    <p>${message}</p>
                    <button onclick="loadPlans()" class="btn btn-primary">ë‹¤ì‹œ ì‹œë„</button>
                </div>
            `;
        }

        // Category filter function
        async function filterByCategory(category) {
            // Update active state of buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            filterState.category = category === 'all' ? 'ALL' : category;
            resetState();
            await loadPlans(false);
        }

        // Sort function (main bar)
        async function sortPlans() {
            const sortValue = document.getElementById('mainSortSelect').value;
            filterState.sort = sortValue;
            // Show/hide age group select
            document.getElementById('mainAgeSelect').style.display = (sortValue === 'POPULAR') ? 'block' : 'none';
            // If not ì¸ê¸°ìˆœ, reset age group to ALL
            if (sortValue !== 'POPULAR') {
                filterState.ageGroup = 'ALL';
                document.getElementById('mainAgeSelect').value = 'ALL';
            }
            resetState();
            await loadPlans(false);
        }

        // Age select function (main bar)
        async function ageGroupChanged() {
            const ageValue = document.getElementById('mainAgeSelect').value;
            filterState.ageGroup = ageValue;
            resetState();
            await loadPlans(false);
        }

        // Load more function
        async function loadMorePlans() {
            if (!hasMoreData) return;

            currentPage++;
            await loadPlans(true); // append mode
        }

        // Update load more button - ìˆ˜ì •ë¨
        function updateLoadMoreButton(currentCount, totalCount) {
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const currentCountEl = document.getElementById('currentCount');
            const totalCountEl = document.getElementById('totalCount');
            const plansCountEl = document.getElementById('plansCount');

            // ì „ì²´ ìš”ê¸ˆì œ ìˆ˜ ì—…ë°ì´íŠ¸
            if (plansCountEl) {
                plansCountEl.textContent = `ì´ ${totalCount}ê°œì˜ ìš”ê¸ˆì œ`;
            }

            // ë”ë³´ê¸° ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ë° ë‚´ìš© ì—…ë°ì´íŠ¸
            if (currentCount > 0 && totalCount > 0) {
                loadMoreContainer.style.display = 'block';

                if (currentCountEl) {
                    currentCountEl.textContent = currentCount;
                }

                if (totalCountEl) {
                    totalCountEl.textContent = totalCount;
                }

                // ë” ë¡œë“œí•  ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                if (loadMoreBtn) {
                    if (!hasMoreData || currentCount >= totalCount) {
                        loadMoreBtn.disabled = true;
                        loadMoreBtn.innerHTML = `${currentCount}ê°œ / ì´ ${totalCount}ê°œ ìƒí’ˆ (ì „ì²´ ë¡œë“œ ì™„ë£Œ)`;
                    } else {
                        loadMoreBtn.disabled = false;
                        loadMoreBtn.innerHTML = `<span class="current-count">${currentCount}</span>ê°œ / ì´ <span>${totalCount}</span>ê°œ ìƒí’ˆ`;
                    }
                }
            } else {
                loadMoreContainer.style.display = 'none';
            }
        }

        // Main load function (uses filterState)
        async function loadPlans(append = false) {
            const { plans, totalCount } = await fetchPlans(currentPage, pageSize, filterState);

            console.log(`ğŸ“¦ ê°€ì ¸ì˜¨ plans ê°œìˆ˜: ${plans.length}`);
            console.log(`ğŸ“Š loadPlans í˜¸ì¶œ ì‹œ loadedPlans: ${loadedPlans.length}ê°œ append=${append}`);

            // 1) ì´ ê°œìˆ˜ ì €ì¥
            totalPlans = totalCount;

            // 2) í™”ë©´ì— ë Œë”ë§ (renderPlans ë‚´ë¶€ì—ì„œ loadedPlansê°€ ê°±ì‹ ë¨)
            renderPlans(plans, append);

            // 3) loadedPlans ê¸¸ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ hasMoreData ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ ê³„ì‚°
            hasMoreData = loadedPlans.length < totalPlans;
            updateLoadMoreButton(loadedPlans.length, totalPlans);
        }

        function goToDetail(planId) {
            // Navigate to plan detail page
            window.location.href = `/plan-detail.html?id=${planId}`;
        }

        // ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        const scrollTopBtn = document.getElementById('scrollTopBtn');

        window.addEventListener('scroll', function () {
            if (window.scrollY > 300) {
                scrollTopBtn.style.display = 'flex';
            } else {
                scrollTopBtn.style.display = 'none';
            }
        });

        scrollTopBtn.addEventListener('click', scrollToTop);

        // --- FILTER MODAL LOGIC ---
        function openFilterModal() {
            document.getElementById('planFilterModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            // Sync modal controls with filterState
            document.getElementById('modalSortSelect').value = filterState.sort;
            document.getElementById('modalCategorySelect').value = filterState.category;
            // Age group radio
            const ageGroupRadios = document.querySelectorAll('#modalAgeFieldset input[name="ageGroup"]');
            ageGroupRadios.forEach(r => { r.checked = (r.value === filterState.ageGroup); });
            // DataType, priceRange
            document.querySelectorAll('#planFilterForm input[name="dataType"]').forEach(r => {
                r.checked = (r.value === filterState.dataType);
            });
            document.querySelectorAll('#planFilterForm input[name="priceRange"]').forEach(r => {
                r.checked = (r.value === filterState.priceRange);
            });
            // Products
            if (!filterState.productNames) {
                document.getElementById('modalNoProduct').checked = false;
                document.querySelectorAll('#planFilterForm input[name="product"]').forEach(cb => { cb.checked = false; });
            } else {
                document.getElementById('modalNoProduct').checked = false;
                const prods = filterState.productNames.split(',');
                document.querySelectorAll('#planFilterForm input[name="product"]').forEach(cb => {
                    cb.checked = prods.includes(cb.value);
                });
            }
            // Show/hide age group in modal
            document.getElementById('modalAgeFieldset').style.display = (filterState.sort === 'POPULAR') ? 'block' : 'none';
        }
        function closeFilterModal() {
            document.getElementById('planFilterModal').style.display = 'none';
            document.body.style.overflow = '';
        }
        // Modal events
        document.addEventListener('DOMContentLoaded', function () {
            // Initial load
            loadPlans(false);

            // Main sort select
            document.getElementById('mainSortSelect').addEventListener('change', sortPlans);
            document.getElementById('mainAgeSelect').addEventListener('change', ageGroupChanged);

            // Load more
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    loadMorePlans();
                });
            }

            // Filter modal open/close
            document.getElementById('openFilterModalBtn').addEventListener('click', openFilterModal);
            document.getElementById('closeFilterModalBtn').addEventListener('click', closeFilterModal);
            document.querySelector('#planFilterModal .modal-overlay').addEventListener('click', closeFilterModal);

            // Modal sort change: show/hide age group
            document.getElementById('modalSortSelect').addEventListener('change', function() {
                document.getElementById('modalAgeFieldset').style.display = (this.value === 'POPULAR') ? 'block' : 'none';
            });
            // í˜œíƒì€ í•„ìš”ì—†ì–´ìš” ì²´í¬ë°•ìŠ¤
            document.getElementById('modalNoProduct').addEventListener('change', function() {
                if (this.checked) {
                    document.querySelectorAll('#planFilterForm input[name="product"]').forEach(cb => { cb.checked = false; });
                }
            });
            document.querySelectorAll('#planFilterForm input[name="product"]').forEach(cb => {
                cb.addEventListener('change', function() {
                    if (this.checked) {
                        document.getElementById('modalNoProduct').checked = false;
                    }
                });
            });

            // ê²€ìƒ‰ ë²„íŠ¼
            document.getElementById('applyFilterBtn').addEventListener('click', function() {
                // Collect filter values from modal
                const sort = document.getElementById('modalSortSelect').value;
                const category = document.getElementById('modalCategorySelect').value;
                let ageGroup = 'ALL';
                if (sort === 'POPULAR') {
                    const checkedAge = document.querySelector('#modalAgeFieldset input[name="ageGroup"]:checked');
                    if (checkedAge) ageGroup = checkedAge.value;
                }
                const dataType = document.querySelector('#planFilterForm input[name="dataType"]:checked').value;
                const priceRange = document.querySelector('#planFilterForm input[name="priceRange"]:checked').value;
                let productNames = '';
                if (!document.getElementById('modalNoProduct').checked) {
                    productNames = Array.from(document.querySelectorAll('#planFilterForm input[name="product"]:checked'))
                        .map(cb => cb.value).join(',');
                }
                // Update filterState
                filterState = {
                    category,
                    dataType,
                    priceRange,
                    productNames,
                    ageGroup,
                    sort
                };
                // Sync main bar
                document.getElementById('mainSortSelect').value = sort;
                document.getElementById('mainAgeSelect').style.display = (sort === 'POPULAR') ? 'block' : 'none';
                document.getElementById('mainAgeSelect').value = ageGroup;
                // Apply filter & close modal
                resetState();
                loadPlans(false);
                closeFilterModal();
            });
        });
    </script>
</body>

</html>
    </script>
    <style>
    .plan-filter-modal {
        position: fixed;
        z-index: 200;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .plan-filter-modal .modal-overlay {
        position: absolute;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.3);
    }
    .plan-filter-modal .modal-content {
        position: relative;
        background: #fff;
        border-radius: 16px;
        max-width: 420px;
        width: 95vw;
        padding: 32px 24px 16px 24px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        z-index: 210;
    }
    .plan-filter-modal .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 18px;
    }
    .plan-filter-modal .modal-header h2 {
        font-size: 22px;
        font-weight: 700;
        margin: 0;
    }
    .modal-close-btn {
        background: none;
        border: none;
        font-size: 26px;
        cursor: pointer;
        color: #aaa;
        transition: color 0.2s;
    }
    .modal-close-btn:hover {
        color: var(--primary);
    }
    .plan-filter-modal .modal-body {
        max-height: 60vh;
        overflow-y: auto;
    }
    .plan-filter-modal .filter-row {
        margin-bottom: 16px;
    }
    .plan-filter-modal label {
        font-size: 15px;
        margin-right: 10px;
    }
    .plan-filter-modal fieldset {
        border: none;
        margin: 0;
        padding: 0;
        margin-bottom: 6px;
    }
    .plan-filter-modal legend {
        font-weight: 600;
        margin-bottom: 4px;
        font-size: 15px;
    }
    .plan-filter-modal input[type="radio"],
    .plan-filter-modal input[type="checkbox"] {
        margin-right: 4px;
    }
    .plan-filter-modal .modal-footer {
        display: flex;
        justify-content: flex-end;
        margin-top: 12px;
    }
    @media (max-width: 600px) {
        .plan-filter-modal .modal-content {
            max-width: 98vw;
            padding: 16px 8px 8px 8px;
        }
    }
    </style>