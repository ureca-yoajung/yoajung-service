<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>요금제 검색 테스트</title>
</head>
<body>
<h1>LG U⁺ 요금제 필터</h1>

<section>
    <label>카테고리:
        <select id="category">
            <option value="LTE_FIVE_G">5G/LTE</option>
            <option value="ONLINE_ONLY">온라인 전용</option>
        </select>
    </label>
    <label>최소 요금: <input type="number" id="minPrice" placeholder="0"></label>
    <label>최대 요금: <input type="number" id="maxPrice" placeholder="100000"></label>
    <label>
        데이터:
        <select id="unlimited">
            <option value="">전체</option>
            <option value="true">무제한</option>
            <option value="false">정량/속도제한</option>
        </select>
    </label>
    <fieldset>
        <legend>프로덕트</legend>
        <label><input type="checkbox" name="product" value="아이들나라">아이들나라</label>
        <label><input type="checkbox" name="product" value="넷플릭스">NETFLIX</label>
        <label><input type="checkbox" name="product" value="바이브">바이브</label>
    </fieldset>
    <button id="searchBtn">검색</button>
</section>

<hr>
<ul id="result"></ul>

<script>
    document.getElementById('searchBtn').addEventListener('click', fetchPlans);

    async function fetchPlans() {
        // ① 폼 값 수집
        const category   = document.getElementById('category').value;
        const minPrice   = document.getElementById('minPrice').value;
        const maxPrice   = document.getElementById('maxPrice').value;
        const unlimited  = document.getElementById('unlimited').value;

        const productNames = [...document.querySelectorAll('input[name="product"]:checked')]
            .map(cb => cb.value)
            .join(',');

        // ② 쿼리스트링 빌드
        const params = new URLSearchParams();
        params.append('category', category);
        if (minPrice)      params.append('minPrice', minPrice);
        if (maxPrice)      params.append('maxPrice', maxPrice);
        if (unlimited)     params.append('unlimited', unlimited);
        if (productNames)  params.append('productNames', productNames);

        // ③ API 호출
        const res  = await fetch(`/api/plans?${params.toString()}`);
        const json = await res.json();          // {code, message, data}

        // ④ 결과 렌더링
        const ul = document.getElementById('result');
        ul.innerHTML = '';

        json.data.forEach(p => {
            const li = document.createElement('li');
            li.textContent = `[${p.name}]  ${p.basePrice.toLocaleString()}원  (${p.dataAllowance >= 9999 ? '무제한' : p.dataAllowance+'GB'})`;
            ul.appendChild(li);
        });
    }
</script>
</body>
</html>