<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
</head>
<body>
<h2>내 정보</h2>
<button onclick="window.location.href='main.html'">메인으로</button>
<button onclick="logout()">로그아웃</button>
<div id="userinfo"></div>
<script>
    function loadMyInfo() {
        fetch('/api/user/me', {
            method: 'GET',
            credentials: 'include'
        })
            .then(res => {
                if (res.status === 401) {
                    alert("로그인이 필요합니다!");
                    window.location.href = "login.html";
                    return;
                }
                return res.json();
            })
            .then(data => {
                if (data && data.data) {
                    document.getElementById('userinfo').innerHTML =
                        `<pre>${JSON.stringify(data.data, null, 2)}</pre>`;
                } else if (data) {
                    document.getElementById('userinfo').innerText =
                        data.message || "정보를 불러오지 못했습니다.";
                }
            });
    }

    function logout() {
        fetch('/api/auth/logout', {
            method: 'POST',
            credentials: 'include'
        })
            .then(res => res.json())
            .then(data => {
                alert(data.message || "로그아웃 완료");
                window.location.href = "login.html";
            });
    }

    window.onload = loadMyInfo;
</script>
</body>
</html>